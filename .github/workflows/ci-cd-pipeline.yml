name: CI/CD Pipeline

# Controls when the workflow will run
on:
  # Triggers on push or pull request to main branch
  push:
    branches: [ Datacom ]
  pull_request:
    branches: [ main ]
  
  # Allows you to run this workflow manually
  workflow_dispatch:

# Environment variables available to all jobs
env:
  PYTHON_VERSION: '3.9'
  PROJECT_NAME: 'my-first-github-actions'

# Jobs to run
jobs:
  # Job 1: Build and Test
  build-and-test:
    name: Build and Test
    runs-on: ubuntu-latest
    
    steps:
      # Step 1: Checkout code
      - name: Checkout repository
        uses: actions/checkout@v3
      
      # Step 2: Set up Python
      - name: Set up Python ${{ env.PYTHON_VERSION }}
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}
      
      # Step 3: Install dependencies
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pytest
          echo "Dependencies installed successfully!"
      
      # Step 4: Create a simple Python test
      - name: Create test file
        run: |
          cat > test_sample.py << 'EOF'
          def test_addition():
              assert 1 + 1 == 2
          
          def test_string():
              assert "Hello" + " " + "World" == "Hello World"
          EOF
      
      # Step 5: Run tests
      - name: Run tests
        run: |
          pytest test_sample.py -v
      
      # Step 6: Display workflow info
      - name: Workflow Information
        run: |
          echo "ðŸŽ‰ Workflow completed successfully!"
          echo "Repository: ${{ github.repository }}"
          echo "Triggered by: ${{ github.actor }}"
          echo "Branch: ${{ github.ref }}"
          echo "Commit SHA: ${{ github.sha }}"
  
  # Job 2: Docker Build (runs after build-and-test)
  docker-build:
    name: Docker Build
    runs-on: ubuntu-latest
    needs: build-and-test
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Create Dockerfile
        run: |
          cat > Dockerfile << 'EOF'
          FROM python:3.9-slim
          WORKDIR /app
          COPY . .
          CMD ["python", "--version"]
          EOF
      
      - name: Build Docker image
        run: |
          docker build -t ${{ env.PROJECT_NAME }}:latest .
          echo "Docker image built successfully!"
      
      - name: Run Docker container
        run: |
          docker run ${{ env.PROJECT_NAME }}:latest
